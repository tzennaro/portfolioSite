"use strict";d3.json("./data/about.json",function(t,e){var r=1110,n=1250,a=75,i=d3.time.format("%Y-%m-%d").parse,s=d3.select("#about-graph-container").append("svg").attr("viewBox","0 0 "+r+" "+n).attr("preserveAspectRatio","xMaxYMin").attr("meetOrSlice","meet").append("g").attr("id","about-graph-group");s.append("clipPath").attr("id","about-area").append("rect").attr("x","0").attr("y","45").attr("width",r).attr("height",n-2*a+30);var c=i("2008-08-01"),l=new Date,o=l.getDate(),u=l.getMonth()+1,d=l.getFullYear();10>o&&(o="0"+o),10>u&&(u="0"+u);var p=i(d+"-"+u+"-"+o),f=d3.time.scale().domain([c,p]).range([n-a,45]),g=d3.scale.ordinal().domain(["education","work","experience","interests"]).rangeRoundBands([a,r-a]),y=d3.scale.ordinal().domain(["rect-sscs","rect-typemetrics","rect-blackmountaincollege_infographics","rect-atlas_urbino","rect-wttc","rect-death_in_venice","rect-sansavenir","rect-whale_wars","rect-urbino_housing","rect-ucla-energy-atlas"]).range(["#sscs","#typemetrics","#blackmountaincollege_infographics","#atlas_urbino","#wttc_infographics","#death_in_venice","#sansavenir","#whale_wars","#urbino_housing","#ucla-energy-atlas"]),h=d3.svg.axis().scale(g).orient("top"),x=d3.svg.axis().scale(f).ticks(20).tickFormat(d3.time.format("%b '%y")).orient("left"),m=_.uniq(e.map(function(t){return t.type}));s.selectAll(".rectGroup").data(m).enter().append("g").attr("class","rectGroup").attr("clip-path","url(#about-area)").attr("id",function(t){return"rect-"+t}),s.selectAll(".textGroup").data(m).enter().append("g").attr("class","textGroup").attr("id",function(t){return"text-"+t}),s.selectAll(".rectGroup").each(function(t){var r=this.id,s=e.filter(function(t){return"rect-education"===r?"education"===t.type:"rect-work"===r?"work"===t.type:"rect-experience"===r?"experience"===t.type:"rect-interests"===r?"interests"===t.type:void 0});d3.select(this).selectAll("rect").data(s).enter().append("rect").attr({id:function(t){return t.id},"class":function(){return"sub"+r},x:function(t,e){return"work"===t.type||"education"===t.type?g(t.type):"interests"===t.type?g(t.type)+(g.rangeBand()/s.length+5)*e+g.rangeBand()/s.length/2-7:g(t.type)+g.rangeBand()/s.length*e},y:function(t){return f(i(t.dateEnd))},height:function(t){return f(i(t.dateStart))-f(i(t.dateEnd))},width:function(t){return"education"===t.type?g.rangeBand()-2:"work"===t.type?g.rangeBand()-2:"interests"===t.type?2:g.rangeBand()/s.length-2},fill:function(t){return"education"===t.type?"#FF3F4C":"work"===t.type?"#72ff80":"experience"===t.type?"#59d0ff":"interests"===t.type?"#353531":void 0},opacity:.35}),"rect-interests"===this.id&&d3.select(this).selectAll("circle").data(s).enter().append("circle").attr({cy:function(t){return i(t.dateStart)<=c?n-a+5:f(i(t.dateStart))+4},cx:function(t,e){return g(t.type)+(g.rangeBand()/s.length+5)*e+g.rangeBand()/s.length/2-6},r:4,stroke:"#353531","stroke-width":2,fill:"#F4F7F5",opacity:.35}),"rect-work"===this.id&&d3.select(this).selectAll("rect").on("mouseover",function(){d3.select(this).transition().duration(150).attr({cursor:"pointer",opacity:.75})}).on("mouseout",function(){d3.select(this).transition().duration(150).attr({opacity:.35})}).on("click",function(t){$(y(t.id)).modal()})}),s.selectAll(".textGroup").each(function(t){function o(t,e){t.each(function(t){for(var a,r=d3.select(this),n=r.text().split(/\s+/).reverse(),i=[],s=0,c=1.2,l=r.attr("x"),o=r.attr("y"),u=r.attr("dy")?r.attr("dy"):0,d=r.text(null).append("tspan").attr("x",l).attr("y",o).attr("dy",u+"em");a=n.pop();)i.push(a),d.text(i.join(" ")),d.node().getComputedTextLength()>e&&(i.pop(),d.text(i.join(" ")),i=[a],d=r.append("tspan").attr("x",l).attr("y",o).attr("dy",++s*c+u+"em").text(a))})}var r=this.id,s=e.filter(function(t){return"text-education"===r?"education"===t.type:"text-work"===r?"work"===t.type:"text-experience"===r?"experience"===t.type:"text-interests"===r?"interests"===t.type:void 0}),l=d3.select(this).selectAll("text").data(s).enter().append("text").attr({"font-family":"FontAwesome, Roboto, serif","pointer-events":"none","font-weight":"regular","font-size":"11px",color:"#353531","class":function(t){return"labelClass-"+t.type},x:function(t,e){return"work"===t.type||"education"===t.type?g(t.type):"experience"===t.type?g(t.type)+g.rangeBand()/s.length*e:g(t.type)+(g.rangeBand()/s.length+5)*e+g.rangeBand()/s.length/2-3},y:function(t,e){return i(t.dateStart)<=c?n-a-2-15*e:f(i(t.dateStart))-2}}).text(function(t){return"interests"===t.type?t.icon+" "+t.name:t.name});"labelClass-work"===l.attr("class")||"labelClass-education"===l.attr("class")?l.call(o,g.rangeBand()):"labelClass-experience"===l.attr("class")&&l.call(o,g.rangeBand()/1.5)}),s.append("g").attr("class","axis").attr("id","xaxis").attr("transform","translate(0, 45)").call(h),s.append("g").attr("class","axis").attr("id","yaxis").attr("transform","translate("+a+", 0)").call(x)});
