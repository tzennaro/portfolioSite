"use strict";d3.tsv("./data/typemetrics.tsv",function(t,e){function n(t,e,n,a,i){function r(t,e,n){return s.domain([t[0],e[0]]).range([t[1],e[1]]),[n,s(n)]}var l=n.map(function(n){return[+n[t],+n[e]]}),o=regression("linear",l).points.sort(function(t,e){return d3.ascending(t[0],e[0])}),s=d3.scale.linear(),c=0,p=parseInt(o.length,10)-1;w=r(o[c],o[p],d3.min(y.domain())),C=r(o[c],o[p],d3.max(y.domain())),a.transition().duration(i).attr("x1",function(){return y(w[0])}).attr("y1",function(){return v(w[1])}).attr("x2",function(){return y(C[0])}).attr("y2",function(){return v(C[1])}).attr("clip-path","url(#scatterplot-area)").style({opacity:.5,"stroke-width":1,"stroke-dasharray":"3, 3"})}function a(t){var e=d3.scale.ordinal().domain(["select","xHeight","CapHeight","Weight","Contrast","Lesser Thickness Slope","Superior Overshooting","Inferior Overshooting","Ascenders","Descenders","n Expansion","o Expansion","n/o Ratio","O Expansion","R Expansion","R/O Ratio","o Average Squaring","o Internal Squaring","o External Squaring"]).range(["select.png","xHeight.png","capHeight.png","Weight.png","Contrast.png","LesThiSlo.png","OvershootingSup.png","OvershootingInf.png","Ascenders.png","Descenders.png","nExp.png","oExp.png","noRat.png","OCapsExp.png","RExp.png","RORat.png","oAvgSqu.png","oIntSqu.png","oExtSqu.png"]);return'<img src="./img/typemetrics/'+e(t)+'">'}function i(t){y=d3.scale.linear().domain(d3.extent(e,function(e){return parseFloat(e[t],10)})).nice().range([H,F-H])}function r(t){v=d3.scale.linear().domain(d3.extent(e,function(e){return parseFloat(e[t])})).nice().range([E-H,H])}function l(){m=d3.scale.linear().domain(d3.extent(e,function(t){return parseFloat(t[z])})).range(["#D6F5D6","#32CD32"]).interpolate(d3.interpolateRgb),h=d3.scale.linear().domain(d3.extent(e,function(t){return parseFloat(t[z])})).range(["#F8D0D8","#DC143C"]).interpolate(d3.interpolateRgb)}function o(t,e,n){t.scale(e),q.select("#"+n).transition().duration(1500).call(t)}function s(){G.transition().duration(1500).attr({cx:function(t){return y(t[R])},cy:function(t){return v(t[O])},fill:function(t){return"Sans"===t.Grazie?m(parseFloat(t[z])):h(parseFloat(t[z]))}})}function c(t){q.select("#circles").selectAll("."+t.replace(/\s/g,"-")).transition().duration(500).attr({stroke:"black","stroke-width":1,opacity:1,r:4.5})}function p(t){q.select("#circles").select("#"+x.replace(/\s/g,"-")+"_"+t.replace(/\s/g,"-")).transition().duration(500).attr({stroke:"black","stroke-width":2,opacity:1,r:7.5})}function d(){G.attr({stroke:"black","stroke-width":0,r:2.5,opacity:.5})}function u(t){N.selectAll(".availableFontWeight").remove(),"---"!==t&&N.select("#fontWeight ul").selectAll("li .availableFontWeight").data(W[t]).enter().append("li").attr("class","availableFontWeight").style({cursor:"pointer",role:"menuitem",tabindex:-1}).text(function(t){return t.StyleName})}var g,x,f,m,h,y,v,S,A,w,C,D=d3.keys(e[0]).filter(function(t){return"FamilyName"!==t&&"Spacing"!==t&&"StyleName"!==t&&"Grazie"!==t&&"Bezier"!==t&&"SimmetriaAggettiT"!==t&&"AltezzaMassimaH"!==t&&"PuntoMedioAstaOrizzontaleH"!==t&&"PuntoMedioAstaVerticaleT"!==t&&"AggettoSinistroT"!==t&&"AggettoDestroT"!==t&&"SimmetriaAggettiT"!==t}),k=e.filter(function(t){return"Sans"===t.Grazie}),b=e.filter(function(t){return"Serif"===t.Grazie}),F=800,E=800,H=50,R="xHeight",O="xHeight",z="xHeight",T=_.sortBy(_.uniq(e,"FamilyName"),"FamilyName"),W=_.groupBy(e,"FamilyName"),q=d3.select("#svg-scatterplot-container").append("svg").attr("viewBox","0 0 "+F+" "+E).attr("preserveAspectRatio","xMaxYMin").attr("meetOrSlice","meet"),N=(q.append("clipPath").attr("id","scatterplot-area").append("rect").attr("x",H).attr("y",H).attr("width",F-2*H).attr("height",E-2*H),d3.select("#svg-scatterplot-legend"));N.select("#fontFamily ul").append("li").style({cursor:"pointer",role:"menuitem",tabindex:-1}).text("---"),N.select("#fontWeight ul").append("li").style({cursor:"pointer",role:"menuitem",tabindex:-1}).text("---"),N.select("#fontFamily ul").selectAll("li .availableFontFamily").filter(function(){return".deselect"!==this["class"]}).data(T).enter().append("li").attr("class","availableFontFamily").style({cursor:"pointer",role:"menuitem",tabindex:-1}).text(function(t){return t.FamilyName}),d3.select("#xAxisScatterplot ul").selectAll("li").data(D).enter().append("li").style({cursor:"pointer",role:"menuitem",tabindex:-1}).text(function(t){return t}),d3.select("#yAxisScatterplot ul").selectAll("li").data(D).enter().append("li").style({cursor:"pointer",role:"menuitem",tabindex:-1}).text(function(t){return t}),d3.select("#circleColor ul").selectAll("li").data(D).enter().append("li").style({cursor:"pointer",role:"menuitem",tabindex:-1}).text(function(t){return t}),i(R),r(O),l(z);var M=q.append("line").attr("id","linRegTot").style("stroke","#353531"),I=q.append("line").attr("id","linRegSans").style("stroke","#32CD32"),P=q.append("line").attr("id","linRegSerif").style("stroke","#DC143C"),L=q.append("line").attr("id","tempLine");n(R,O,e,M,1500),n(R,O,k,I,1500),n(R,O,b,P,1500);var G=q.append("g").attr("id","circles").attr("clip-path","url(#scatterplot-area)").selectAll("circle").data(e).enter().append("circle").attr({"class":function(t){return t.FamilyName.replace(/\s/g,"-")},id:function(t){return t.FamilyName.replace(/\s/g,"-")+"_"+t.StyleName.replace(/\s/g,"-")}});s(),d(),S=d3.svg.axis().scale(y).ticks(20).orient("bottom"),A=d3.svg.axis().scale(v).ticks(20).orient("left"),q.append("g").attr("class","axis").attr("id","xaxis").attr("transform","translate(0,"+(E-H)+")").call(S),q.append("g").attr("class","axis").attr("id","yaxis").attr("transform","translate("+H+", 0)").call(A),$("#fontFamily").on("click",".dropdown-menu li",function(){x=$(this).text(),$("#fontFamilyDropdown").html(x+' <i class="fa fa-caret-down"></i>'),$("#fontFamilyDropdown").val(x),d(),"---"!==x?(c(x),u(x),g=e.filter(function(t){return t.FamilyName==x}),n(R,O,g,L,0)):"---"===x&&($("#fontWeightDropdown").html('--- <i class="fa fa-caret-down"></i>'),$("#fontWeightDropdown").val("---"),d(),u(x),g=[0,0],n(R,O,g,L,0))}),$("#fontWeight").on("click",".dropdown-menu li",function(){f=$(this).text(),$("#fontWeightDropdown").html(f+' <i class="fa fa-caret-down"></i>'),$("#fontWeightDropdown").val(f),"---"!==f?(c(x),p(f)):c(x)}),d3.select("#xAxisScatterplot a").attr("data-content",a("select")),d3.select("#yAxisScatterplot a").attr("data-content",a("select")),d3.select("#circleColor a").attr("data-content",a("select")),$("#xAxisScatterplot").on("click",".dropdown-menu li",function(){R=$(this).text(),$("#xAxisScatterplotDropdown").html(R+' <i class="fa fa-caret-down"></i>'),$("#xAxisScatterplotDropdown").val(R);var t=$("#xAxisScatterplotDropdown").val();d3.select("#xAxisScatterplot a").attr("data-content",a(t)),i(R),s(),o(S,y,"xaxis"),n(R,O,e,M,1500),n(R,O,k,I,1500),n(R,O,b,P,1500),n(R,O,g,L,1500)}),$("#yAxisScatterplot").on("click",".dropdown-menu li",function(){O=$(this).text(),$("#yAxisScatterplotDropdown").html(O+' <i class="fa fa-caret-down"></i>'),$("#yAxisScatterplotDropdown").val(O);var t=$("#yAxisScatterplotDropdown").val();d3.select("#yAxisScatterplot a").attr("data-content",a(t)),r(O),s(),o(A,v,"yaxis"),n(R,O,e,M,1500),n(R,O,k,I,1500),n(R,O,b,P,1500),n(R,O,g,L,1500)}),$("#circleColor").on("click",".dropdown-menu li",function(){z=$(this).text(),$("#circleColorDropdown").html(z+' <i class="fa fa-caret-down"></i>'),$("#circleColorDropdown").val(z);var t=$("#circleColorDropdown").val();d3.select("#circleColor a").attr("data-content",a(t)),l(z),s(),$("#SelColLegend").text(z)})}),d3.tsv("./data/typemetrics.tsv",function(t,e){function n(t,e,n){return d3.layout.histogram().bins(t).value(function(t){return t[e]})(n)}function a(t){g=d3.scale.linear().domain(d3.extent(e,function(e){return parseFloat(e[t],10)})).nice().range([S,y-S])}function i(t,e,n){t.scale(e),A.select("#"+n).transition().duration(1500).call(t)}function r(t){return d3.max(t,function(t){return t.y})}function l(t,e){var n=[t,e];return d3.max(n,function(t){return t})}function o(t){x=d3.scale.linear().domain([0,t+5]).nice().range([v-S,S])}function s(t,e,n){var a=A.select("#"+t+"Circles");A.selectAll("."+t+"circleSubgroup").remove(),a.append("g").attr("id",t+"FilledCircles").selectAll("circle").data(e).enter().append("g").each(function(t){t.forEach(function(e){e.x=t.x})}).selectAll("circle").data(function(t){return t}).enter().append("circle").attr({"class":t+"circleSubgroup",cx:function(t){return g(t.x)},cy:function(t,e){return x(e+1)},r:2,fill:n,opacity:.25}),a.append("g").attr("id",t+"PointCircles").selectAll("circle").data(e).enter().append("circle").attr({"class":t+"circleSubgroup",cx:function(t){return g(t.x)},cy:function(t){return x(t.y)},r:2,stroke:n,fill:"white"}),a.selectAll("text").data(e).enter().append("text").text(function(t){return t.y>=1?t.y:null}).attr({"class":t+"circleSubgroup","text-anchor":"middle","font-size":"10px",fill:n,x:function(t){return g(t.x)},y:function(t){return x(t.y)-7.5}})}function c(t,e){t.transition().duration(750).attr("d",w(e))}function p(t){var e=d3.scale.ordinal().domain(["select","xHeight","CapHeight","Weight","Contrast","Lesser Thickness Slope","Superior Overshooting","Inferior Overshooting","Ascenders","Descenders","n Expansion","o Expansion","n/o Ratio","O Expansion","R Expansion","R/O Ratio","o Average Squaring","o Internal Squaring","o External Squaring"]).range(["select.png","xHeight.png","capHeight.png","Weight.png","Contrast.png","LesThiSlo.png","OvershootingSup.png","OvershootingInf.png","Ascenders.png","Descenders.png","nExp.png","oExp.png","noRat.png","OCapsExp.png","RExp.png","RORat.png","oAvgSqu.png","oIntSqu.png","oExtSqu.png"]);return'<img src="./img/typemetrics/'+e(t)+'">'}var d,u,g,x,f=d3.keys(e[0]).filter(function(t){return"FamilyName"!==t&&"Spacing"!==t&&"StyleName"!==t&&"Grazie"!==t&&"Bezier"!==t&&"SimmetriaAggettiT"!==t&&"AltezzaMassimaH"!==t&&"PuntoMedioAstaOrizzontaleH"!==t&&"PuntoMedioAstaVerticaleT"!==t&&"AggettoSinistroT"!==t&&"AggettoDestroT"!==t&&"SimmetriaAggettiT"!==t}),m=e.filter(function(t){return"Sans"===t.Grazie}),h=e.filter(function(t){return"Serif"===t.Grazie}),y=1e3,v=500,S=50,A=d3.select("#svg-histogram-container").append("svg").attr("viewBox","0 0 "+y+" "+v).attr("preserveAspectRatio","xMaxYMin").attr("meetOrSlice","meet"),w=(A.append("clipPath").attr("id","histogram-area").append("rect").attr("x",S).attr("y",S).attr("width",y-2*S).attr("height",v-2*S),d3.select("#svg-histogram-legend"),d3.svg.line().interpolate("monotone").x(function(t){return g(t.x)}).y(function(t){return x(t.y)}));d=25,u="xHeight",d3.select("#xAxisHistogram ul").selectAll("li").data(f).enter().append("li").style({cursor:"pointer",role:"menuitem",tabindex:-1}).text(function(t){return t}),n(d,u,m),n(d,u,h),a(u),o(l(r(n(d,u,m)),r(n(d,u,h))));var C=A.append("path").attr("clip-path","url(#histogram-area)").attr("class","sansElements").attr("id","SansPath").style({fill:"none",stroke:"#32CD32","stroke-width":"1px",visibility:"visible"}),D=A.append("path").attr("clip-path","url(#histogram-area)").attr("class","serifElements").attr("id","SerifPath").style({fill:"none",stroke:"#DC143C","stroke-width":"1px",visibility:"visible"});A.append("g").attr("id","sansCircles").attr("class","sansElements").attr("clip-path","url(#histogram-area)"),A.append("g").attr("id","serifCircles").attr("class","serifElements").attr("clip-path","url(#histogram-area)"),s("sans",n(d,u,m),"#32CD32"),c(C,n(d,u,m)),s("serif",n(d,u,h),"#DC143C"),c(D,n(d,u,h));var k=d3.svg.axis().scale(g).orient("bottom").ticks(20);A.append("g").attr("id","xaxis").attr("class","x axis").attr("transform","translate(0,"+(v-S)+")").call(k);var b=d3.svg.axis().scale(x).tickSize(900).orient("left"),F=A.append("g").attr("id","yaxis").attr("class","y axis").attr("transform","translate("+(y-S)+", 0)").call(b);F.selectAll("g").filter(function(t){return t}).classed("minor",!0),d3.select("#xAxisHistogram a").attr("data-content",p("select")),$("#xAxisHistogram").on("click",".dropdown-menu li",function(){u=$(this).text(),$("#xAxisHistogramDropdown").html(u+' <i class="fa fa-caret-down"></i>'),$("#xAxisHistogramDropdown").val(u);var t=$("#xAxisHistogramDropdown").val();d3.select("#xAxisHistogram a").attr("data-content",p(t)),n(d,u,m),n(d,u,h),a(u),o(l(r(n(d,u,m)),r(n(d,u,h)))),i(k,g,"xaxis"),i(b,x,"yaxis"),s("sans",n(d,u,m),"#32CD32"),c(C,n(d,u,m)),s("serif",n(d,u,h),"#DC143C"),c(D,n(d,u,h))}),d3.select("#histogramSlider").on("change",function(){d=+$(this).val(),n(d,u,m),n(d,u,h),o(l(r(n(d,u,m)),r(n(d,u,h)))),i(b,x,"yaxis"),s("sans",n(d,u,m),"#32CD32"),c(C,n(d,u,m)),s("serif",n(d,u,h),"#DC143C"),c(D,n(d,u,h))}),$("#SansLineCheckbox").on("change",function(){this.checked===!0?A.selectAll(".sansElements").style("visibility","visible"):A.selectAll(".sansElements").style("visibility","hidden")}),$("#SerifLineCheckbox").on("click",function(){this.checked===!0?A.selectAll(".serifElements").style("visibility","visible"):A.selectAll(".serifElements").style("visibility","hidden")})});