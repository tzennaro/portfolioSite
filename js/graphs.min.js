"use strict";d3.tsv("./data/typemetrics.tsv",function(t,e){function n(t,e,n){return d3.layout.histogram().bins(t).value(function(t){return t[e]})(n)}function a(t){g=d3.scale.linear().domain(d3.extent(e,function(e){return parseFloat(e[t],10)})).nice().range([S,y-S])}function r(t,e,n){t.scale(e),A.select("#"+n).transition().duration(1500).call(t)}function i(t){return d3.max(t,function(t){return t.y})}function l(t,e){var n=[t,e];return d3.max(n,function(t){return t})}function o(t){x=d3.scale.linear().domain([0,t+5]).nice().range([v-S,S])}function s(t,e,n){var a=A.select("#"+t+"Circles");A.selectAll("."+t+"circleSubgroup").remove(),a.append("g").attr("id",t+"FilledCircles").selectAll("circle").data(e).enter().append("g").each(function(t){t.forEach(function(e){e.x=t.x})}).selectAll("circle").data(function(t){return t}).enter().append("circle").attr({"class":t+"circleSubgroup",cx:function(t){return g(t.x)},cy:function(t,e){return x(e+1)},r:2,fill:n,opacity:.25}),a.append("g").attr("id",t+"PointCircles").selectAll("circle").data(e).enter().append("circle").attr({"class":t+"circleSubgroup",cx:function(t){return g(t.x)},cy:function(t){return x(t.y)},r:2,stroke:n,fill:"white"}),a.selectAll("text").data(e).enter().append("text").text(function(t){return t.y>=1?t.y:null}).attr({"class":t+"circleSubgroup","text-anchor":"middle","font-size":"10px",fill:n,x:function(t){return g(t.x)},y:function(t){return x(t.y)-7.5}})}function c(t,e){t.transition().duration(750).attr("d",w(e))}function p(t){var e=d3.scale.ordinal().domain(["select","xHeight","CapHeight","Weight","Contrast","Lesser Thickness Slope","Superior Overshooting","Inferior Overshooting","Ascenders","Descenders","n Expansion","o Expansion","n/o Ratio","O Expansion","R Expansion","R/O Ratio","o Average Squaring","o Internal Squaring","o External Squaring"]).range(["select.png","xHeight.png","capHeight.png","Weight.png","Contrast.png","LesThiSlo.png","OvershootingSup.png","OvershootingInf.png","Ascenders.png","Descenders.png","nExp.png","oExp.png","noRat.png","OCapsExp.png","RExp.png","RORat.png","oAvgSqu.png","oIntSqu.png","oExtSqu.png"]);return'<img src="./img/typemetrics/'+e(t)+'">'}var d,u,g,x,f=d3.keys(e[0]).filter(function(t){return"FamilyName"!==t&&"Spacing"!==t&&"StyleName"!==t&&"Grazie"!==t&&"Bezier"!==t&&"SimmetriaAggettiT"!==t&&"AltezzaMassimaH"!==t&&"PuntoMedioAstaOrizzontaleH"!==t&&"PuntoMedioAstaVerticaleT"!==t&&"AggettoSinistroT"!==t&&"AggettoDestroT"!==t&&"SimmetriaAggettiT"!==t}),m=e.filter(function(t){return"Sans"===t.Grazie}),h=e.filter(function(t){return"Serif"===t.Grazie}),y=1e3,v=500,S=50,A=d3.select("#svg-histogram-container").append("svg").attr("viewBox","0 0 "+y+" "+v).attr("preserveAspectRatio","xMaxYMin").attr("meetOrSlice","meet"),w=(A.append("clipPath").attr("id","histogram-area").append("rect").attr("x",S).attr("y",S).attr("width",y-2*S).attr("height",v-2*S),d3.select("#svg-histogram-legend"),d3.svg.line().interpolate("monotone").x(function(t){return g(t.x)}).y(function(t){return x(t.y)}));d=25,u="xHeight",d3.select("#xAxisHistogram ul").selectAll("li").data(f).enter().append("li").style({cursor:"pointer",role:"menuitem",tabindex:-1}).text(function(t){return t}),n(d,u,m),n(d,u,h),a(u),o(l(i(n(d,u,m)),i(n(d,u,h))));var C=A.append("path").attr("clip-path","url(#histogram-area)").attr("class","sansElements").attr("id","SansPath").style({fill:"none",stroke:"#32CD32","stroke-width":"1px",visibility:"visible"}),D=A.append("path").attr("clip-path","url(#histogram-area)").attr("class","serifElements").attr("id","SerifPath").style({fill:"none",stroke:"#DC143C","stroke-width":"1px",visibility:"visible"});A.append("g").attr("id","sansCircles").attr("class","sansElements").attr("clip-path","url(#histogram-area)"),A.append("g").attr("id","serifCircles").attr("class","serifElements").attr("clip-path","url(#histogram-area)"),s("sans",n(d,u,m),"#32CD32"),c(C,n(d,u,m)),s("serif",n(d,u,h),"#DC143C"),c(D,n(d,u,h));var k=d3.svg.axis().scale(g).orient("bottom").ticks(20);A.append("g").attr("id","xaxis").attr("class","x axis").attr("transform","translate(0,"+(v-S)+")").call(k);var b=d3.svg.axis().scale(x).tickSize(900).orient("left"),F=A.append("g").attr("id","yaxis").attr("class","y axis").attr("transform","translate("+(y-S)+", 0)").call(b);F.selectAll("g").filter(function(t){return t}).classed("minor",!0),d3.select("#xAxisHistogram a").attr("data-content",p("select")),$("#xAxisHistogram").on("click",".dropdown-menu li",function(){u=$(this).text(),$("#xAxisHistogramDropdown").html(u+' <i class="fa fa-caret-down"></i>'),$("#xAxisHistogramDropdown").val(u);var t=$("#xAxisHistogramDropdown").val();d3.select("#xAxisHistogram a").attr("data-content",p(t)),n(d,u,m),n(d,u,h),a(u),o(l(i(n(d,u,m)),i(n(d,u,h)))),r(k,g,"xaxis"),r(b,x,"yaxis"),s("sans",n(d,u,m),"#32CD32"),c(C,n(d,u,m)),s("serif",n(d,u,h),"#DC143C"),c(D,n(d,u,h))}),d3.select("#histogramSlider").on("change",function(){d=+$(this).val(),n(d,u,m),n(d,u,h),o(l(i(n(d,u,m)),i(n(d,u,h)))),r(b,x,"yaxis"),s("sans",n(d,u,m),"#32CD32"),c(C,n(d,u,m)),s("serif",n(d,u,h),"#DC143C"),c(D,n(d,u,h))}),$("#SansLineCheckbox").on("change",function(){this.checked===!0?A.selectAll(".sansElements").style("visibility","visible"):A.selectAll(".sansElements").style("visibility","hidden")}),$("#SerifLineCheckbox").on("click",function(){this.checked===!0?A.selectAll(".serifElements").style("visibility","visible"):A.selectAll(".serifElements").style("visibility","hidden")})}),d3.tsv("./data/typemetrics.tsv",function(t,e){function n(t,e,n,a,r){function i(t,e,n){return s.domain([t[0],e[0]]).range([t[1],e[1]]),[n,s(n)]}var l=n.map(function(n){return[+n[t],+n[e]]}),o=regression("linear",l).points.sort(function(t,e){return d3.ascending(t[0],e[0])}),s=d3.scale.linear(),c=0,p=parseInt(o.length,10)-1;C=i(o[c],o[p],d3.min(v.domain())),D=i(o[c],o[p],d3.max(v.domain())),a.transition().duration(r).attr("x1",function(){return v(C[0])}).attr("y1",function(){return S(C[1])}).attr("x2",function(){return v(D[0])}).attr("y2",function(){return S(D[1])}).attr("clip-path","url(#scatterplot-area)").style({opacity:.5,"stroke-width":1,"stroke-dasharray":"3, 3"})}function a(t){var e=d3.scale.ordinal().domain(["select","xHeight","CapHeight","Weight","Contrast","Lesser Thickness Slope","Superior Overshooting","Inferior Overshooting","Ascenders","Descenders","n Expansion","o Expansion","n/o Ratio","O Expansion","R Expansion","R/O Ratio","o Average Squaring","o Internal Squaring","o External Squaring"]).range(["select.png","xHeight.png","capHeight.png","Weight.png","Contrast.png","LesThiSlo.png","OvershootingSup.png","OvershootingInf.png","Ascenders.png","Descenders.png","nExp.png","oExp.png","noRat.png","OCapsExp.png","RExp.png","RORat.png","oAvgSqu.png","oIntSqu.png","oExtSqu.png"]);return'<img src="./img/typemetrics/'+e(t)+'">'}function r(t){v=d3.scale.linear().domain(d3.extent(e,function(e){return parseFloat(e[t],10)})).nice().range([R,E-R])}function i(t){S=d3.scale.linear().domain(d3.extent(e,function(e){return parseFloat(e[t])})).nice().range([H-R,R])}function l(){h=d3.scale.linear().domain(d3.extent(e,function(t){return parseFloat(t[T])})).range(["#D6F5D6","#32CD32"]).interpolate(d3.interpolateRgb),y=d3.scale.linear().domain(d3.extent(e,function(t){return parseFloat(t[T])})).range(["#F8D0D8","#DC143C"]).interpolate(d3.interpolateRgb)}function o(t,e,n){t.scale(e),q.select("#"+n).transition().duration(1500).call(t)}function s(){B.transition().duration(1500).attr({cx:function(t){return v(t[O])},cy:function(t){return S(t[z])},fill:function(t){return"Sans"===t.Grazie?h(parseFloat(t[T])):y(parseFloat(t[T]))}})}function c(t,e){q.select("#circles").selectAll("."+t.replace(/\s/g,"-")).transition().duration(e).attr({stroke:"black","stroke-width":1,opacity:1,r:6})}function p(t,e){q.select("#circles").select("#"+f.replace(/\s/g,"-")+"_"+t.replace(/\s/g,"-")).transition().duration(e).attr({stroke:"black","stroke-width":2,opacity:1,r:10})}function d(){B.attr({stroke:"black","stroke-width":0,r:4,opacity:.5})}function u(t){M.selectAll(".availableFontWeight").remove(),"---"!==t&&M.select("#fontWeight ul").selectAll("li .availableFontWeight").data(W[t]).enter().append("li").attr("class","availableFontWeight").style({cursor:"pointer",role:"menuitem",tabindex:-1}).text(function(t){return t.StyleName})}function g(t,e,n){t.each(function(){for(var t,a=d3.select(this),r=a.text().split(/;/).reverse(),i=[],l=0,o=1.1,s=a.attr("y"),c=a.attr("dy")?a.attr("dy"):0,p=a.text(null).append("tspan").attr("x",n).attr("y",s).attr("dy",c+"em");t=r.pop();)i.push(t),p.text(i.join(" ")),p.node().getComputedTextLength()>e&&(i.pop(),p.text(i.join(" ")),i=[t],p=a.append("tspan").attr("x",n).attr("y",s).attr("dy",++l*o+c+"em").text(t))})}var x,f,m,h,y,v,S,A,w,C,D,k=d3.keys(e[0]).filter(function(t){return"FamilyName"!==t&&"Spacing"!==t&&"StyleName"!==t&&"Grazie"!==t&&"Bezier"!==t&&"SimmetriaAggettiT"!==t&&"AltezzaMassimaH"!==t&&"PuntoMedioAstaOrizzontaleH"!==t&&"PuntoMedioAstaVerticaleT"!==t&&"AggettoSinistroT"!==t&&"AggettoDestroT"!==t&&"SimmetriaAggettiT"!==t}),b=e.filter(function(t){return"Sans"===t.Grazie}),F=e.filter(function(t){return"Serif"===t.Grazie}),E=855,H=860,R=50,O="xHeight",z="xHeight",T="xHeight",N=_.sortBy(_.uniq(e,"FamilyName"),"FamilyName"),W=_.groupBy(e,"FamilyName"),q=d3.select("#svg-scatterplot-container").append("svg").attr("viewBox","0 0 "+E+" "+H).attr("preserveAspectRatio","xMaxYMin").attr("meetOrSlice","meet"),M=(q.append("clipPath").attr("id","scatterplot-area").append("rect").attr("x",R).attr("y",R).attr("width",E-2*R).attr("height",H-2*R),d3.select("#svg-scatterplot-legend"));M.select("#fontFamily ul").append("li").style({cursor:"pointer",role:"menuitem",tabindex:-1}).text("---"),M.select("#fontWeight ul").append("li").style({cursor:"pointer",role:"menuitem",tabindex:-1}).text("---"),M.select("#fontFamily ul").selectAll("li .availableFontFamily").filter(function(){return".deselect"!==this["class"]}).data(N).enter().append("li").attr("class","availableFontFamily").style({cursor:"pointer",role:"menuitem",tabindex:-1}).text(function(t){return t.FamilyName}),d3.select("#xAxisScatterplot ul").selectAll("li").data(k).enter().append("li").style({cursor:"pointer",role:"menuitem",tabindex:-1}).text(function(t){return t}),d3.select("#yAxisScatterplot ul").selectAll("li").data(k).enter().append("li").style({cursor:"pointer",role:"menuitem",tabindex:-1}).text(function(t){return t}),d3.select("#circleColor ul").selectAll("li").data(k).enter().append("li").style({cursor:"pointer",role:"menuitem",tabindex:-1}).text(function(t){return t}),r(O),i(z),l(T);var I=q.append("line").attr("id","linRegTot").style("stroke","#353531"),L=q.append("line").attr("id","linRegSans").style("stroke","#32CD32"),P=q.append("line").attr("id","linRegSerif").style("stroke","#DC143C"),G=q.append("line").attr("id","tempLine");n(O,z,e,I,1500),n(O,z,b,L,1500),n(O,z,F,P,1500);var B=q.append("g").attr("id","circles").attr("clip-path","url(#scatterplot-area)").selectAll("circle").data(e).enter().append("circle").attr({"class":function(t){return t.FamilyName.replace(/\s/g,"-")},id:function(t){return t.FamilyName.replace(/\s/g,"-")+"_"+t.StyleName.replace(/\s/g,"-")}}).on("mouseover",function(t){q.selectAll("circle").attr("opacity",.25),d3.select(this).transition().duration(500).attr({r:10,opacity:1});var e=d3.select(this).attr("cx"),n=parseFloat(d3.select(this).attr("cy"));q.append("text").attr({"class":"circleTooltip",x:e,y:n-H/15,"pointer-events":"none","text-anchor":E/2>e?"start":"end"}).text("Family: "+t.FamilyName+";Style: "+t.StyleName+";"+O+": "+t[O]+", "+z+": "+t[z]).call(g,50,e)}).on("mouseout",function(){q.selectAll(".circleTooltip").remove(),d(),c(f,0),p(m,0)});s(),d(),A=d3.svg.axis().scale(v).ticks(20).orient("bottom"),w=d3.svg.axis().scale(S).ticks(20).orient("left"),q.append("g").attr("class","axis").attr("id","xaxis").attr("transform","translate(0,"+(H-R)+")").call(A),q.append("g").attr("class","axis").attr("id","yaxis").attr("transform","translate("+R+", 0)").call(w),$("#fontFamily").on("click",".dropdown-menu li",function(){f=$(this).text(),$("#fontFamilyDropdown").html(f+' <i class="fa fa-caret-down"></i>'),$("#fontFamilyDropdown").val(f),d(),"---"!==f?(c(f,500),u(f),x=e.filter(function(t){return t.FamilyName==f}),n(O,z,x,G,0)):"---"===f&&($("#fontWeightDropdown").html('--- <i class="fa fa-caret-down"></i>'),$("#fontWeightDropdown").val("---"),d(),u(f),x=[0,0],n(O,z,x,G,0))}),$("#fontWeight").on("click",".dropdown-menu li",function(){m=$(this).text(),$("#fontWeightDropdown").html(m+' <i class="fa fa-caret-down"></i>'),$("#fontWeightDropdown").val(m),"---"!==m?(c(f,500),p(m,500)):c(f)}),d3.select("#xAxisScatterplot a").attr("data-content",a("select")),d3.select("#yAxisScatterplot a").attr("data-content",a("select")),d3.select("#circleColor a").attr("data-content",a("select")),$("#xAxisScatterplot").on("click",".dropdown-menu li",function(){O=$(this).text(),$("#xAxisScatterplotDropdown").html(O+' <i class="fa fa-caret-down"></i>'),$("#xAxisScatterplotDropdown").val(O);var t=$("#xAxisScatterplotDropdown").val();d3.select("#xAxisScatterplot a").attr("data-content",a(t)),r(O),s(),o(A,v,"xaxis"),n(O,z,e,I,1500),n(O,z,b,L,1500),n(O,z,F,P,1500),n(O,z,x,G,1500)}),$("#yAxisScatterplot").on("click",".dropdown-menu li",function(){z=$(this).text(),$("#yAxisScatterplotDropdown").html(z+' <i class="fa fa-caret-down"></i>'),$("#yAxisScatterplotDropdown").val(z);var t=$("#yAxisScatterplotDropdown").val();d3.select("#yAxisScatterplot a").attr("data-content",a(t)),i(z),s(),o(w,S,"yaxis"),n(O,z,e,I,1500),n(O,z,b,L,1500),n(O,z,F,P,1500),n(O,z,x,G,1500)}),$("#circleColor").on("click",".dropdown-menu li",function(){T=$(this).text(),$("#circleColorDropdown").html(T+' <i class="fa fa-caret-down"></i>'),$("#circleColorDropdown").val(T);var t=$("#circleColorDropdown").val();d3.select("#circleColor a").attr("data-content",a(t)),l(T),s(),$("#SelColLegend").text(T)})});
