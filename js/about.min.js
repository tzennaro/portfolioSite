"use strict";d3.json("./data/about.json",function(t,e){var r=1140,a=1409,n=55,i=d3.time.format("%Y-%m-%d").parse,c=d3.select("#about-graph-container").append("svg").attr("viewBox","0 0 "+r+" "+a).attr("preserveAspectRatio","xMaxYMin").attr("meetOrSlice","meet");c.append("clipPath").attr("id","about-area").append("rect").attr("x",n).attr("y",n).attr("width",r).attr("height",a-2*n);var s=i("2008-08-01"),l=new Date,o=l.getDate(),d=l.getMonth()+1,p=l.getFullYear();10>o&&(o="0"+o),10>d&&(d="0"+d);var u=i(p+"-"+d+"-"+o),y=d3.time.scale().domain([s,u]).range([a-n,n]),x=d3.scale.ordinal().domain(["education","work","experience","interests"]).rangeRoundBands([n,r-n]),g=textures.lines().lighter().thicker().orientation("3/8").stroke("#F4F7F5").background("#FF3F4C"),f=textures.lines().lighter().thicker().orientation("3/8").stroke("#F4F7F5").background("#72ff80"),h=textures.lines().lighter().thicker().orientation("3/8").stroke("#F4F7F5").background("#59d0ff"),k=d3.svg.axis().scale(x).orient("top"),m=d3.svg.axis().scale(y).ticks(20).tickFormat(d3.time.format("%b '%y")).orient("left");c.append("g").attr("class","axis").attr("id","xaxis").attr("transform","translate(0, "+n+")").call(k),c.append("g").attr("class","axis").attr("id","yaxis").attr("transform","translate("+n+", 0)").call(m);var F=_.uniq(e.map(function(t){return t.type}));c.selectAll(".rectGroup").data(F).enter().append("g").attr("class","rectGroup").attr("clip-path","url(#about-area)").attr("id",function(t){return"rect-"+t}),c.selectAll(".textGroup").data(F).enter().append("g").attr("class","textGroup").attr("clip-path","url(#about-area)").attr("id",function(t){return"text-"+t}),c.selectAll(".rectGroup").each(function(){var t=this.id,r=e.filter(function(e){return"rect-education"===t?"education"===e.type:"rect-work"===t?"work"===e.type:"rect-experience"===t?"experience"===e.type:"rect-interests"===t?"interests"===e.type:void 0});d3.select(this).selectAll("rect").data(r).enter().append("rect").attr({id:function(t){return t.id},"class":function(){return"sub"+t},x:function(t,e){return"work"===t.type||"education"===t.type?x(t.type):"interests"===t.type?x(t.type)+(x.rangeBand()/r.length+5)*e+x.rangeBand()/r.length/2:x(t.type)+x.rangeBand()/r.length*e},y:function(t){return y(i(t.dateEnd))},height:function(t){return y(i(t.dateStart))-y(i(t.dateEnd))},width:function(t){return"work"===t.type||"education"===t.type?x.rangeBand()-2:"interests"===t.type?1:x.rangeBand()/r.length-2},fill:function(t){return"education"===t.type?(c.call(g),g.url()):"work"===t.type?(c.call(f),f.url()):"experience"===t.type?(c.call(h),h.url()):"interests"===t.type?"#353531":void 0},opacity:.35}),"rect-interests"===this.id&&d3.select(this).selectAll("circle").data(r).enter().append("circle").attr({cy:function(t){return i(t.dateStart)<=s?a-n+5:y(i(t.dateStart))+4},cx:function(t,e){return x(t.type)+(x.rangeBand()/r.length+5)*e+x.rangeBand()/r.length/2+1},r:4,stroke:"#353531","stroke-width":1,fill:"#F4F7F5",opacity:.35})}),c.selectAll(".textGroup").each(function(){function t(t,e){t.each(function(){for(var t,r=d3.select(this),a=r.text().split(/\s+/).reverse(),n=[],i=0,c=1.2,s=r.attr("x"),l=r.attr("y"),o=r.attr("dy")?r.attr("dy"):0,d=r.text(null).append("tspan").attr("x",s).attr("y",l).attr("dy",o+"em");t=a.pop();)n.push(t),d.text(n.join(" ")),d.node().getComputedTextLength()>e&&(n.pop(),d.text(n.join(" ")),n=[t],d=r.append("tspan").attr("x",s).attr("y",l).attr("dy",++i*c+o+"em").text(t))})}var r=this.id,c=e.filter(function(t){return"text-education"===r?"education"===t.type:"text-work"===r?"work"===t.type:"text-experience"===r?"experience"===t.type:"text-interests"===r?"interests"===t.type:void 0}),l=d3.select(this).selectAll("text").data(c).enter().append("text").attr({"font-family":"FontAwesome, Roboto, serif",color:"#353531","class":function(t){return"labelClass-"+t.type},x:function(t,e){return"work"===t.type||"education"===t.type?x(t.type):"experience"===t.type?x(t.type)+x.rangeBand()/c.length*e:x(t.type)+(x.rangeBand()/c.length+5)*e+x.rangeBand()/c.length/2+3},y:function(t){return i(t.dateStart)<=s?a-n-5:y(i(t.dateStart))-5}}).text(function(t){return"interests"===t.type?t.icon+" "+t.name:t.name});if("labelClass-work"===l.attr("class")||"labelClass-education"===l.attr("class"))l.call(t,x.rangeBand());else if("labelClass-experience"===l.attr("class"))return l.call(t,x.rangeBand()/1.5)})});