"use strict";d3.json("./data/about.json",function(t,e){var a=1110,r=1250,n=75,i=d3.time.format("%Y-%m-%d").parse,c=d3.select("#about-graph-container").append("svg").attr("viewBox","0 0 "+a+" "+r).attr("preserveAspectRatio","xMaxYMin").attr("meetOrSlice","meet").append("g").attr("id","about-graph-group");c.append("clipPath").attr("id","about-area").append("rect").attr("x","0").attr("y","45").attr("width",a).attr("height",r-2*n+30);var s=i("2008-08-01"),o=new Date,l=o.getDate(),d=o.getMonth()+1,p=o.getFullYear();10>l&&(l="0"+l),10>d&&(d="0"+d);var u=i(p+"-"+d+"-"+l),y=d3.time.scale().domain([s,u]).range([r-n,45]),g=d3.scale.ordinal().domain(["education","work","experience","interests"]).rangeRoundBands([n,a-n]),f=d3.scale.ordinal().domain(["rect-sscs","rect-typemetrics","rect-blackmountaincollege_infographics","rect-atlas_urbino","rect-wttc","rect-death_in_venice","rect-sansavenir","rect-whale_wars","rect-urbino_housing"]).range(["#sscs","#typemetrics","#blackmountaincollege_infographics","#atlas_urbino","#wttc_infographics","#death_in_venice","#sansavenir","#whale_wars","#urbino_housing"]),h=d3.svg.axis().scale(g).orient("top"),x=d3.svg.axis().scale(y).ticks(20).tickFormat(d3.time.format("%b '%y")).orient("left"),m=_.uniq(e.map(function(t){return t.type}));c.selectAll(".rectGroup").data(m).enter().append("g").attr("class","rectGroup").attr("clip-path","url(#about-area)").attr("id",function(t){return"rect-"+t}),c.selectAll(".textGroup").data(m).enter().append("g").attr("class","textGroup").attr("id",function(t){return"text-"+t}),c.selectAll(".rectGroup").each(function(){var t=this.id,a=e.filter(function(e){return"rect-education"===t?"education"===e.type:"rect-work"===t?"work"===e.type:"rect-experience"===t?"experience"===e.type:"rect-interests"===t?"interests"===e.type:void 0});d3.select(this).selectAll("rect").data(a).enter().append("rect").attr({id:function(t){return t.id},"class":function(){return"sub"+t},x:function(t,e){return"work"===t.type||"education"===t.type?g(t.type):"interests"===t.type?g(t.type)+(g.rangeBand()/a.length+5)*e+g.rangeBand()/a.length/2-7:g(t.type)+g.rangeBand()/a.length*e},y:function(t){return y(i(t.dateEnd))},height:function(t){return y(i(t.dateStart))-y(i(t.dateEnd))},width:function(t){return"education"===t.type?g.rangeBand()-2:"work"===t.type?g.rangeBand()-2:"interests"===t.type?2:g.rangeBand()/a.length-2},fill:function(t){return"education"===t.type?"#FF3F4C":"work"===t.type?"#72ff80":"experience"===t.type?"#59d0ff":"interests"===t.type?"#353531":void 0},opacity:.35}),"rect-interests"===this.id&&d3.select(this).selectAll("circle").data(a).enter().append("circle").attr({cy:function(t){return i(t.dateStart)<=s?r-n+5:y(i(t.dateStart))+4},cx:function(t,e){return g(t.type)+(g.rangeBand()/a.length+5)*e+g.rangeBand()/a.length/2-6},r:4,stroke:"#353531","stroke-width":2,fill:"#F4F7F5",opacity:.35}),"rect-work"===this.id&&d3.select(this).selectAll("rect").on("mouseover",function(){d3.select(this).transition().duration(150).attr({cursor:"pointer",opacity:.75})}).on("mouseout",function(){d3.select(this).transition().duration(150).attr({opacity:.35})}).on("click",function(t){$(f(t.id)).modal()})}),c.selectAll(".textGroup").each(function(){function t(t,e){t.each(function(){for(var t,a=d3.select(this),r=a.text().split(/\s+/).reverse(),n=[],i=0,c=1.2,s=a.attr("x"),o=a.attr("y"),l=a.attr("dy")?a.attr("dy"):0,d=a.text(null).append("tspan").attr("x",s).attr("y",o).attr("dy",l+"em");t=r.pop();)n.push(t),d.text(n.join(" ")),d.node().getComputedTextLength()>e&&(n.pop(),d.text(n.join(" ")),n=[t],d=a.append("tspan").attr("x",s).attr("y",o).attr("dy",++i*c+l+"em").text(t))})}var a=this.id,c=e.filter(function(t){return"text-education"===a?"education"===t.type:"text-work"===a?"work"===t.type:"text-experience"===a?"experience"===t.type:"text-interests"===a?"interests"===t.type:void 0}),o=d3.select(this).selectAll("text").data(c).enter().append("text").attr({"font-family":"FontAwesome, Roboto, serif","pointer-events":"none","font-weight":"regular","font-size":"11px",color:"#353531","class":function(t){return"labelClass-"+t.type},x:function(t,e){return"work"===t.type||"education"===t.type?g(t.type):"experience"===t.type?g(t.type)+g.rangeBand()/c.length*e:g(t.type)+(g.rangeBand()/c.length+5)*e+g.rangeBand()/c.length/2-3},y:function(t,e){return i(t.dateStart)<=s?r-n-2-15*e:y(i(t.dateStart))-2}}).text(function(t){return"interests"===t.type?t.icon+" "+t.name:t.name});"labelClass-work"===o.attr("class")||"labelClass-education"===o.attr("class")?o.call(t,g.rangeBand()):"labelClass-experience"===o.attr("class")&&o.call(t,g.rangeBand()/1.5)}),c.append("g").attr("class","axis").attr("id","xaxis").attr("transform","translate(0, 45)").call(h),c.append("g").attr("class","axis").attr("id","yaxis").attr("transform","translate("+n+", 0)").call(x)});